#!/usr/bin/env bash

# ============================
# CONFIGURATION À PERSONNALISERR
# ============================

PORTAL_URL="http://192.168.33.2:8002/index.php?zone=portail_rt"

# Identifiants de la première méthode
USER1="TON_USER"
PASS1="TON_PASSWORD"

# Identifiants de la seconde méthode (si inutiles, laisse vide)
USER2=""
PASS2=""

# URL de redirection après login (souvent vide)
REDIR=""

# Fichier cookie temporaire
COOKIE_JAR="/tmp/pfsense_cookies.txt"

# ============================

# Étape 1 : Obtenir les cookies de session
curl -k -s -c "$COOKIE_JAR" "$PORTAL_URL" > /dev/null

# Étape 2 : Envoyer la requête de login
curl -k -s -b "$COOKIE_JAR" -c "$COOKIE_JAR" \
  -d "auth_user=${USER1}" \
  -d "auth_pass=${PASS1}" \
  -d "auth_user2=${USER2}" \
  -d "auth_pass2=${PASS2}" \
  -d "redirurl=${REDIR}" \
  -d "accept=Login" \
  "$PORTAL_URL" > /dev/null 2>&1

echo "Connexion envoyée au portail captif pfSense."
